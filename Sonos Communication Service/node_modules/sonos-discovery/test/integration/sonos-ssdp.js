'use strict';

var expect = require('chai').expect;
var sinon = require('sinon');
var proxyquire = require('proxyquire');
require('chai').use(require('sinon-chai'));

describe('Make sure it finds players', function () {
  var ssdp = void 0;

  beforeEach(function () {
    ssdp = require('../../lib/sonos-ssdp');
    ssdp.start();
  });

  afterEach(function () {
    ssdp.stop();
  });

  it('Finds players', function (done) {
    var handler = sinon.spy(function (topology) {
      expect(topology.location).to.match(/^http:\/\/\d+\.\d+\.\d+\.\d+:1400/);
      expect(topology.household).not.empty;
      expect(topology.ip).to.match(/^\d+\.\d+\.\d+\.\d+$/);
      done();
    });

    ssdp.on('found', handler);
  });
});